<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{% block title %}Estación Meteorológica{% endblock %}</title>
    {% block stylesheets %}
        <link rel="stylesheet" href="{{ asset('bootstrap-4.4.0-dist/css/bootstrap.min.css') }}">
        <link rel="stylesheet" href="{{ asset('fontawesome-free-5.11.2-web/css/all.css') }}">
        <link rel="stylesheet" href="{{ asset('css/estilos.css') }}">
    {% endblock %}
    <link rel="icon" type="image/x-icon" href="{{ asset('favicon.ico') }}" />
</head>
<body>
{% block body %}{% endblock %}

{% block javascripts %}
    <script src="{{ asset('jquery/jquery-3.5.1.min.js') }}"></script>
    <script src="{{ asset('bootstrap-4.4.0-dist/js/bootstrap.min.js') }}"></script>
    <script src="{{ asset('chartjs/Chart.min.js') }}"></script>
    <script>
        $(function () {
            //llamadaAjax();
        });

        function llamadaAjax() {
            $.ajax('{{ asset('estacion.php') }}',{
                dataType: 'text',
                statusCode: {
                    404: function () {
                        alert('pagina no encontrada');
                    }
                },
                error: function () {
                    alert('ocurrio un error');
                },
                success: function (paginaDevuelta) {
                    let miForm = document.getElementById("formRegistroEstacion");
                    let datosDevueltos = paginaDevuelta.substring(paginaDevuelta.lastIndexOf('<body>') + 6, paginaDevuelta.lastIndexOf('</body>'));
                    let conjuntoDatos = datosDevueltos.split('<br/>');

                    for(let i = 0; i < conjuntoDatos.length; i++){
                        let datos = conjuntoDatos[i].trim().split(': ');
                        switch (datos[0]) {
                            case 'temperatura':
                                document.getElementById('campoTemperatura').value = datos[1];
                                break;
                            case 'humedad':
                                document.getElementById('campoHumedad').value = datos[1];
                                break;
                            case 'lluvia':
                                document.getElementById('campoLluvia').value = datos[1];
                                break;
                            case 'viento':
                                document.getElementById('campoViento').value = datos[1];
                                break;
                            case 'dirViento':
                                document.getElementById('campoDirViento').value = datos[1];
                                break;
                        }
                    }
                    document.getElementById('datos').textContent = conjuntoDatos;

                    miForm.submit();
                }
            });
        }
    </script>
    {% block javascripts2 %}{% endblock %}
{% endblock %}
</body>
</html>
